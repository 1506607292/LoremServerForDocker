(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[6],{3900:function(t,e,s){},"4ec3":function(t,e,s){"use strict";s.d(e,"d",(function(){return i})),s.d(e,"j",(function(){return n})),s.d(e,"f",(function(){return r})),s.d(e,"h",(function(){return o})),s.d(e,"g",(function(){return u})),s.d(e,"c",(function(){return c})),s.d(e,"e",(function(){return d})),s.d(e,"b",(function(){return l})),s.d(e,"i",(function(){return p})),s.d(e,"a",(function(){return h}));var a=s("b775");const i=t=>Object(a["a"])({url:"/api/question/answer",method:"get",params:t}),n=(t,e)=>Object(a["a"])({url:"/api/question/answer",method:"post",params:t,data:e}),r=t=>Object(a["a"])({url:"/api/user/login",method:"post",data:t}),o=t=>Object(a["a"])({url:"/api/user/register",method:"post",data:t}),u=t=>Object(a["a"])({url:"/api/user/logout",method:"post",data:t}),c=t=>Object(a["a"])({url:"/api/user/getcaptcha",method:"get",data:t}),d=t=>Object(a["a"])({url:"/api/user/userinfo",method:"get",data:t}),l=t=>Object(a["a"])({url:"/api/user/userinfo",method:"put",data:t}),p=t=>Object(a["a"])({url:"/api/user/changepw",method:"post",data:t}),h=t=>Object(a["a"])({url:"/api/user/changepw",method:"put",data:t})},"84fe":function(t,e,s){"use strict";s("3900")},b775:function(t,e,s){"use strict";(function(t){var a=s("bc3a"),i=s.n(a),n=s("2a19");const r=i.a.create({baseURL:t.env.VUE_APP_BASE_API,timeout:99999,withCredentials:!0});r.interceptors.request.use((t=>{let e=(void 0).$cookies.get("csrftoken");return t.data=JSON.stringify(t.data),t.headers={"Content-Type":"application/json","X-CSRFToken":e},t}),(t=>(n["a"].create({message:t.toString(),color:"negative",position:"top",timeout:2e3,icon:"warning"}),t))),r.interceptors.response.use((t=>{switch(t.data.code){case 0:return t;case 1:return n["a"].create({message:t.data.message.toString(),color:"warning",position:"top",timeout:2e3}),setTimeout((()=>{document.cookie="username=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",document.cookie="token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",location.reload()}),500),t;case 2:return n["a"].create({message:t.data.message.toString(),color:"orange",position:"top",timeout:2e3}),t;case-1:return n["a"].create({message:"系统错误",color:"deep-orange-14",position:"top",timeout:2e3}),t;case 7:return n["a"].create({message:t.data.message.toString(),color:"warning",position:"top",timeout:2e3}),t;default:return t}}),(t=>(n["a"].create({message:t.toString(),color:"negative",position:"top",timeout:2e3,icon:"warning"}),t))),e["a"]=r}).call(this,s("4362"))},e3ba:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-page",{staticClass:"main-con ",class:{"flex flex-center column":!t.showQuestions}},[t.loading?s("div",{staticClass:"flex flex-center text-secondary text-h7"},[s("q-inner-loading",{attrs:{showing:""}},[s("q-spinner-gears",{attrs:{size:"50px",color:"secondary"}}),s("br"),t._v("\n      加载中...\n    ")],1)],1):t.demoMode||103===t.surveyData.statusCode?s("div",{staticClass:"flex column items-stretch"},[s("div",{staticClass:"paper-header"},[s("div",{staticClass:"text-h4 text-center paper-title"},[t._v(t._s(t.surveyData.title))]),t.$route.params.token?s("div",{staticClass:"text-center paper-time"},[t._v("ID:"+t._s(t.$route.params.token.toUpperCase()))]):t._e(),s("br"),s("div",{domProps:{innerHTML:t._s(t.surveyData.desc)}})]),t.showQuestions?t._e():s("div",{staticClass:"text-center q-pa-lg"},[s("q-space"),s("q-btn",{attrs:{outline:"",icon:"arrow_downward",color:"secondary",round:""},on:{click:t.startQuiz}},[s("q-tooltip",{attrs:{"content-class":"desktop-only"}},[t._v("\n          开始问卷\n        ")])],1)],1),s("transition",{attrs:{name:"fade"}},[t.showQuestions?s("q-form",{ref:"surveyForm",staticClass:"column",attrs:{autocorrect:"off",autocapitalize:"off",spellcheck:"false"},on:{"validation-error":t.validError}},[t._l(t.surveyData.questionSet,(function(e,a){return s("div",{key:a,staticClass:"ques-section"},[t.loading?t._e():s("q-separator",{staticClass:"q-mb-sm",staticStyle:{background:"rgba(0, 0, 0, 0.05)"},attrs:{size:"2px"}}),0===e.type?s("div",[s("div",{staticClass:"text-h6 ques-title-large"},[s("b",[t._v(t._s(t._f("formatIndex")(e.index))+" / ")]),""!==e.title?s("span",[t._v(t._s(e.title))]):s("span",{staticClass:"text-italic text-grey"},[t._v("(未设置题目)")]),e.need?s("span",{staticClass:"text-red"},[t._v(" *")]):t._e()]),s("q-input",{attrs:{disable:1===t.submitted,placeholder:"请输入",dense:!0,filled:"",rules:[function(t){return!e.need||null!=t&&""!=t||"必填项"}]},on:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;e.preventDefault()}},model:{value:t.answer.questionSet[a].answer,callback:function(e){t.$set(t.answer.questionSet[a],"answer",e)},expression:"answer.questionSet[i].answer"}})],1):1===e.type||2===e.type?s("div",[s("div",{staticClass:"text-h6 ques-title"},[s("b",[t._v(t._s(t._f("formatIndex")(e.index))+" / ")]),""!==e.title?s("span",[t._v(t._s(e.title))]):s("span",{staticClass:"text-italic text-grey"},[t._v("(未设置题目)")]),e.need?s("span",{staticClass:"text-red"},[t._v(" *")]):t._e(),2===e.type?s("q-chip",{staticClass:"float-right",attrs:{dense:"",square:"",outline:"",color:"teal-4",label:"多选题"}}):t._e()],1),s("q-field",{attrs:{rules:[function(t){return!e.need||null!=t||"必填项"}],borderless:"",disable:1===t.submitted},scopedSlots:t._u([{key:"control",fn:function(){return[s("q-option-group",{attrs:{options:e.options,color:"primary",type:1===e.type?"radio":"checkbox"},model:{value:t.answer.questionSet[a].answer,callback:function(e){t.$set(t.answer.questionSet[a],"answer",e)},expression:"answer.questionSet[i].answer"}})]},proxy:!0}],null,!0),model:{value:t.answer.questionSet[a].answer,callback:function(e){t.$set(t.answer.questionSet[a],"answer",e)},expression:"answer.questionSet[i].answer"}})],1):t._e()],1)})),s("q-btn",{staticClass:"flex-center submit-btn",attrs:{label:1===t.submitted?"提交成功":"提交",color:1===t.submitted?"secondary":"primary",disable:0!==t.submitted,loading:-1===t.submitted},on:{click:t.submit}})],2):t._e()],1)],1):104===t.surveyData.statusCode?s("div",{staticClass:"flex flex-center text-secondary text-h5 q-mt-lg"},[t._v("\n    您已提交此问卷\n  ")]):s("div",{staticClass:"flex flex-center text-secondary text-h5 q-mt-lg"},[t._v("\n    问卷已停止收集\n  ")]),s("br"),t.loading?t._e():s("q-separator",{staticClass:"q-ma-md"}),t.loading?t._e():s("div",{staticClass:"paper-footer text-center",class:{"fixed-bottom":!t.showQuestions},staticStyle:{height:"100px"}},[t._v("\n    Copyright © 2021 LoremIpsum Team\n    "),s("br"),t._v("\n    问卷系统由"),s("a",{staticClass:"no-wrap q-link",attrs:{href:"/"}},[t._v("LoremSurvey")]),t._v("提供\n    "),s("br"),s("a",{staticClass:"q-link",attrs:{href:"#"}},[t._v("意见反馈")])])],1)},i=[],n=(s("4e82"),s("2a19")),r=s("4ec3"),o={name:"survey",props:{sdata:Object},data(){return{surveyData:{title:"",desc:"",questionSet:[]},answer:{questionSet:[]},submitted:0,res:null,sessionId:null,demoMode:!1,loading:!0,showQuestions:!1}},mounted(){},async created(){if(!this.$route.params.token)return this.demoMode=!0,void(this.loading=!1);this.sessionId=this.$route.params.token;const t=await Object(r["d"])({sessionid:this.sessionId});if(this.surveyData=t.data.data,105===this.surveyData.statusCode&&await this.$router.push("/survey"),103===this.surveyData.statusCode){document.title=this.surveyData.title+" -LoremSurvey",this.surveyData.running||(this.submitted=1),this.surveyData.questionSet.sort(((t,e)=>t.index>e.index?1:-1));for(let t=0;t<this.surveyData.questionSet.length;++t)1===this.surveyData.questionSet[t].type||0===this.surveyData.questionSet[t].type?this.answer.questionSet.push({index:t+1,answer:null,id:this.surveyData.questionSet[t].id}):2===this.surveyData.questionSet[t].type&&this.answer.questionSet.push({index:t+1,answer:[],id:this.surveyData.questionSet[t].id})}this.loading=!1},mounted(){this.demoMode&&this.$nextTick((()=>{this.surveyData=this.$props.sdata,this.surveyData.questionSet.sort(((t,e)=>t.index>e.index?1:-1));for(let t=0;t<this.surveyData.questionSet.length;++t)1===this.surveyData.questionSet[t].type||0===this.surveyData.questionSet[t].type?this.answer.questionSet.push({index:t+1,answer:null,id:this.surveyData.questionSet[t].id}):2===this.surveyData.questionSet[t].type&&this.answer.questionSet.push({index:t+1,answer:[],id:this.surveyData.questionSet[t].id})}))},filters:{formatIndex:function(t){return t<10?"0"+t:t}},methods:{startQuiz(){this.showQuestions=!0},submit(){this.$refs.surveyForm.validate().then((t=>{if(t){if(this.demoMode)return n["a"].create({message:"模拟提交动作，不会收集数据",color:"secondary",position:"top",timeout:500}),this.submitted=-1,void setTimeout((()=>{this.submitted=1}),1e3);this.submitted=-1,Object(r["j"])({sessionid:this.sessionId},{questionSet:this.answer.questionSet}).then((t=>{0===t.data.code?this.submitted=1:this.submitted=0}))}}))},validError(){n["a"].create({message:"存在未填项",color:"negative",position:"top",timeout:1500,icon:"warning"})}}},u=o,c=(s("84fe"),s("2877")),d=s("9989"),l=s("74f7"),p=s("cf57"),h=s("2c91"),m=s("9c40"),v=s("05c0"),f=s("0378"),y=s("eb85"),g=s("27f9"),b=s("b047"),q=s("8572"),w=s("9f0a"),x=s("eebe"),S=s.n(x),_=Object(c["a"])(u,a,i,!1,null,"13cd747c",null);e["default"]=_.exports;S()(_,"components",{QPage:d["a"],QInnerLoading:l["a"],QSpinnerGears:p["a"],QSpace:h["a"],QBtn:m["a"],QTooltip:v["a"],QForm:f["a"],QSeparator:y["a"],QInput:g["a"],QChip:b["a"],QField:q["a"],QOptionGroup:w["a"]})}}]);