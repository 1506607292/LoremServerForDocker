(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{"013f":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",{staticClass:"flex flex-center"},[a("q-form",{on:{submit:t.onLogin}},[a("q-card",{staticClass:"flex column login-card"},[a("div",{staticClass:"text-h4"},[t._v("登录问卷系统")]),a("br"),a("q-input",{attrs:{label:"用户名",maxlength:"20","lazy-rules":"",rules:[function(t){return t&&t.length>0||"请输入用户名"}]},scopedSlots:t._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"account_box"}})]},proxy:!0}]),model:{value:t.loginForm.username,callback:function(e){t.$set(t.loginForm,"username",e)},expression:"loginForm.username"}}),a("q-input",{attrs:{label:"密码",maxlength:"20",type:t.isPwd?"password":"text","lazy-rules":"",rules:[function(t){return t&&t.length>0||"请输入密码"}]},scopedSlots:t._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"lock"}})]},proxy:!0},{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:t.isPwd?"visibility_off":"visibility"},on:{click:function(e){t.isPwd=!t.isPwd}}})]},proxy:!0}]),model:{value:t.loginForm.password,callback:function(e){t.$set(t.loginForm,"password",e)},expression:"loginForm.password"}}),a("q-input",{attrs:{label:"验证码",maxlength:"20","lazy-rules":"",rules:[function(t){return t&&t.length>0||"请输入验证码"}]},scopedSlots:t._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"how_to_reg"}})]},proxy:!0},{key:"after",fn:function(){return[a("q-img",{staticStyle:{cursor:"pointer"},attrs:{src:"data:image/png;base64,"+t.captchaImg,width:"100px",height:"50px"},on:{click:t.getCaptchaData},scopedSlots:t._u([{key:"error",fn:function(){return[a("div",{staticClass:"absolute-full flex flex-center bg-grey"},[a("q-icon",{attrs:{name:"refresh",size:"22px"}})],1)]},proxy:!0}])})]},proxy:!0}]),model:{value:t.loginForm.captcha.code,callback:function(e){t.$set(t.loginForm.captcha,"code",e)},expression:"loginForm.captcha.code"}}),a("q-btn",{attrs:{color:"primary",type:"submit",label:"登录",loading:t.loading}}),a("div",{staticClass:"text-center"},[a("q-btn",{attrs:{flat:"",dense:""},on:{click:t.toForget}},[t._v("找回密码")]),t._v("\n         \n        "),a("q-btn",{attrs:{flat:"",dense:""},on:{click:t.toReg}},[t._v("注册新账号")])],1)],1)],1)],1)},n=[],r=(a("5319"),a("4ec3")),s={name:"Login",data(){return{isPwd:!0,loginForm:{username:"",password:"",captcha:{code:"",id:""}},loading:!1,captchaImg:null,reloadCaptcha:null}},created(){this.getCaptchaData()},methods:{getCaptchaData(){Object(r["c"])().then((t=>{this.loginForm.captcha.code="",this.loginForm.captcha.id=t.data.data.id,this.captchaImg=t.data.data.base64Data,this.reloadCaptcha&&clearTimeout(this.reloadCaptcha),this.reloadCaptcha=setTimeout((()=>{this.captchaImg=""}),4e4)}))},toReg(){this.$router.push("register")},toForget(){this.$router.push("forget")},onLogin(){this.loading=!0;let t=JSON.parse(JSON.stringify(this.loginForm));t.password=this.$md5(this.loginForm.password),Object(r["f"])(t).then((t=>{0===t.data.code?(this.loading=!1,this.$router.replace("manage")):(this.loginForm.password="",this.getCaptchaData()),this.loading=!1})).catch((()=>{this.loginForm.password="",this.getCaptchaData(),this.loading=!1}))}}},i=s,c=(a("f058"),a("2877")),u=a("9989"),l=a("0378"),p=a("f09f"),d=a("27f9"),g=a("0016"),m=a("068f"),h=a("9c40"),f=a("eebe"),b=a.n(f),w=Object(c["a"])(i,o,n,!1,null,"29ca1755",null);e["default"]=w.exports;b()(w,"components",{QPage:u["a"],QForm:l["a"],QCard:p["a"],QInput:d["a"],QIcon:g["a"],QImg:m["a"],QBtn:h["a"]})},"26ac":function(t,e,a){},"4ec3":function(t,e,a){"use strict";a.d(e,"d",(function(){return n})),a.d(e,"j",(function(){return r})),a.d(e,"f",(function(){return s})),a.d(e,"h",(function(){return i})),a.d(e,"g",(function(){return c})),a.d(e,"c",(function(){return u})),a.d(e,"e",(function(){return l})),a.d(e,"b",(function(){return p})),a.d(e,"i",(function(){return d})),a.d(e,"a",(function(){return g}));var o=a("b775");const n=t=>Object(o["a"])({url:"/api/question/answer",method:"get",params:t}),r=(t,e)=>Object(o["a"])({url:"/api/question/answer",method:"post",params:t,data:e}),s=t=>Object(o["a"])({url:"/api/user/login",method:"post",data:t}),i=t=>Object(o["a"])({url:"/api/user/register",method:"post",data:t}),c=t=>Object(o["a"])({url:"/api/user/logout",method:"post",data:t}),u=t=>Object(o["a"])({url:"/api/user/getcaptcha",method:"get",data:t}),l=t=>Object(o["a"])({url:"/api/user/userinfo",method:"get",data:t}),p=t=>Object(o["a"])({url:"/api/user/userinfo",method:"put",data:t}),d=t=>Object(o["a"])({url:"/api/user/changepw",method:"post",data:t}),g=t=>Object(o["a"])({url:"/api/user/changepw",method:"put",data:t})},b775:function(t,e,a){"use strict";(function(t){var o=a("bc3a"),n=a.n(o),r=a("2a19"),s=a("2b27"),i=a.n(s);const c=n.a.create({baseURL:t.env.VUE_APP_BASE_API,timeout:99999,withCredentials:!0});c.interceptors.request.use((t=>{let e=null;return i.a.isKey("csrftoken")&&(e=i.a.get("csrftoken")),t.data=JSON.stringify(t.data),t.headers={"Content-Type":"application/json","X-CSRFToken":e},t}),(t=>(r["a"].create({message:t.toString(),color:"negative",position:"top",timeout:2e3,icon:"warning"}),t))),c.interceptors.response.use((t=>{switch(t.data.code){case 0:return t;case 1:return r["a"].create({message:t.data.message.toString(),color:"warning",position:"top",timeout:2e3}),setTimeout((()=>{document.cookie="username=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",document.cookie="token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",location.reload()}),500),t;case 2:return r["a"].create({message:t.data.message.toString(),color:"orange",position:"top",timeout:2e3}),t;case-1:return r["a"].create({message:"系统错误",color:"deep-orange-14",position:"top",timeout:2e3}),t;case 7:return r["a"].create({message:t.data.message.toString(),color:"warning",position:"top",timeout:2e3}),t;default:return t}}),(t=>(r["a"].create({message:t.toString(),color:"negative",position:"top",timeout:2e3,icon:"warning"}),t))),e["a"]=c}).call(this,a("4362"))},f058:function(t,e,a){"use strict";a("26ac")}}]);